<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Coze Agent Chat with Voice</title>
</head>
<body>
  <h2>Coze Agent Chatï¼ˆæ”¯æŒè¯­éŸ³è¯†åˆ«ï¼‰</h2>
  <!-- è¯­éŸ³è¯†åˆ«æŒ‰é’® -->
  <button id="voice">ğŸ¤ è¯­éŸ³è¾“å…¥</button>
  <!-- å®˜æ–¹åµŒå…¥ä»£ç  -->
  <script src="https://sf-cdn.coze.com/obj/unpkg-va/flow-platform/chat-app-sdk/1.2.0-beta.6/libs/oversea/index.js"></script>
  <script>
    new CozeWebSDK.WebChatClient({
      config: {
        bot_id: '7573652690762366981',
      },
      componentProps: {
        title: 'Coze',
      },
      auth: {
        type: 'token',
        token: 'pat_pAKjsXCfwee7tT65SRQZIVth92dYea2U1VGFrP8js6hsPAA4Eif64AIjLIRnCl83',
        onRefreshToken: function () {
          return 'cztei_0riLRQTX4k3hdcCEf3C5NfVf0OcJn0brE3n7wRbycfqqnrN0w9sXphXSRzmPVLvda'
        }
      }
    });

    // è¯­éŸ³è¯†åˆ«éƒ¨åˆ†
    let recognition;
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = 'zh-CN';
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.onresult = function(event) {
        // è¯†åˆ«ç»“æœå¡«åˆ° Coze èŠå¤©çª—å£è¾“å…¥æ¡†
        // å®˜æ–¹çª—å£åŠ è½½æœ‰å»¶è¿Ÿï¼Œéœ€ç­‰å¾…å…ƒç´ å‡ºç°
        let inputBox = document.querySelector('.coze-webchat-input');
        if (inputBox) {
          inputBox.value = event.results[0][0].transcript;
        } else {
          alert('æ‰¾ä¸åˆ°èŠå¤©è¾“å…¥æ¡†ï¼Œè¯·ç¨ç­‰çª—å£åŠ è½½å®Œæˆåå†è¯•');
        }
      };
    }

    document.getElementById('voice').onclick = function() {
      if (recognition) recognition.start();
      else alert('ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«');
    };
  </script>
</body>
</html>
